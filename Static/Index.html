<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>InsightPulse</title>
<style>
:root{--bg:#000;--surface:#050a0a;--muted:#0d1c1c;--text:#eaffff;--sub:#a5f7f1;--teal3:#26d9cf;--mint:#4afff0}
body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);
background:linear-gradient(135deg,#001212,#002626,#001212)}
section{max-width:1100px;margin:0 auto;padding:2rem 1rem}
h1{margin:0 0 .5rem;color:var(--mint);text-align:center}
p.lead{text-align:center;color:#c8ffff;margin:0 0 1rem}
.row{display:flex;gap:1rem;flex-wrap:wrap;align-items:center;justify-content:center}
.card{background:#050a0a;border:1px solid var(--muted);border-radius:12px;padding:1rem;
box-shadow:0 0 14px rgba(38,217,207,.4),0 0 28px rgba(74,255,240,.15)}
.fileBox{display:flex;flex-direction:column;align-items:center;gap:.6rem}
.fileBox input[type=file]{font-size:18px;padding:.8rem;border:2px dashed var(--teal3);border-radius:14px;background:#021616;color:#eaffff}
.drop{border:2px dashed var(--teal3);border-radius:14px;padding:1.1rem;text-align:center;color:#a5f7f1;background:#021616}
.drop.drag{background:#062222;box-shadow:0 0 16px rgba(74,255,240,.5)}
.kpis{display:flex;gap:1rem;flex-wrap:wrap;margin-top:1rem}
.kpi{flex:1 1 180px;text-align:center;background:#050a0a;border:1px solid var(--muted);border-radius:12px;padding:1rem}
.kpi .v{font-size:2rem;color:var(--mint);font-weight:800}.kpi .l{color:#a5f7f1}
.chart{flex:1 1 320px}.chart svg{width:100%;height:220px;background:#000;border:1px solid #178;border-radius:10px}
table{width:100%;border-collapse:collapse;color:#eaffff}th,td{padding:.6rem;border-bottom:1px solid #178;text-align:left;white-space:nowrap}
th{color:var(--mint);background:#021111}
</style>
</head>
<body>
<section>
  <h1>InsightPulse • Static Build</h1>
  <p class="lead">Build: STATIC-OK • iPad-friendly</p>

  <div class="row">
    <div class="card fileBox">
      <input id="picker" type="file" accept=".csv,text/csv,text/plain,application/vnd.ms-excel">
      <small>Tap “Choose File” above to load your CSV</small>
      <a href="data:text/csv,Month,Revenue%0AJan,12000%0AFeb,14100%0AMar,15750%0AApr,17040%0AMay,16660%0AJun,18220%0AJul,19510"
         download="sample.csv" style="color:#4afff0;text-decoration:underline">Download sample CSV</a>
    </div>
    <div class="card drop" id="drop"><strong>Optional:</strong> on desktop, drop a CSV here</div>
  </div>

  <div class="row kpis">
    <div class="kpi"><div class="v" id="k1">0</div><div class="l">Total</div></div>
    <div class="kpi"><div class="v" id="k2">0</div><div class="l">Average ×100</div></div>
    <div class="kpi"><div class="v" id="k3">0%</div><div class="l">Growth</div></div>
  </div>

  <div class="row" style="margin-top:1rem">
    <div class="chart card"><svg id="line"></svg></div>
    <div class="chart card"><svg id="bars"></svg></div>
  </div>

  <div class="card" style="margin-top:1rem">
    <table id="tbl"><thead></thead><tbody></tbody></table>
  </div>
</section>

<script>
const $=s=>document.querySelector(s);
const picker=$('#picker'); const drop=$('#drop');

picker.addEventListener('change',e=>{
  const f=e.target.files&&e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=ev=>renderAll(parseCSV(String(ev.target.result||'')));
  r.readAsText(f);
});
if(drop){
  ['dragenter','dragover'].forEach(t=>drop.addEventListener(t,e=>{e.preventDefault();drop.classList.add('drag');}));
  ['dragleave','dragend','drop'].forEach(t=>drop.addEventListener(t,e=>{e.preventDefault();drop.classList.remove('drag');}));
  drop.addEventListener('drop',e=>{
    const f=e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0]; if(!f) return;
    const r=new FileReader(); r.onload=ev=>renderAll(parseCSV(String(ev.target.result||''))); r.readAsText(f);
  });
}
function parseCSV(t){
  const lines=t.trim().split(/\r?\n/);
  return lines.map(line=>{
    const out=[];let cur='',q=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='"'){q=!q;}
      else if(ch===','&&!q){out.push(cur);cur='';}
      else{cur+=ch;}
    }
    out.push(cur);
    return out.map(c=>c.replace(/^"|"$/g,''));
  });
}
function firstNumCol(rows){
  if(rows.length<2) return -1;
  for(let c=1;c<rows[0].length;c++){
    if(rows.slice(1).some(r=>!isNaN(parseFloat(r[c])))) return c;
  } return -1;
}
function renderAll(rows){
  if(!rows||!rows.length) return;
  const n=firstNumCol(rows);
  fillTable(rows);
  if(n!==-1){updateKPIs(rows,n);drawLine(rows,n);drawBars(rows,n);}
  window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
}
function fillTable(rows){
  const th=$('#tbl thead'), tb=$('#tbl tbody');
  th.innerHTML='<tr>'+rows[0].map(h=>`<th>${h}</th>`).join('')+'</tr>';
  tb.innerHTML=rows.slice(1).map(r=>'<tr>'+r.map(c=>`<td>${c}</td>`).join('')+'</tr>').join('');
}
function updateKPIs(rows,n){
  const xs=rows.slice(1).map(r=>parseFloat(r[n])).filter(x=>!isNaN(x)); if(!xs.length) return;
  const sum=xs.reduce((a,b)=>a+b,0), avg=sum/xs.length, growth=xs[0]?((xs.at(-1)-xs[0])/Math.abs(xs[0]))*100:0;
  $('#k1').textContent=sum.toFixed(2); $('#k2').textContent=(avg*100).toFixed(2); $('#k3').textContent=growth.toFixed(2)+'%';
}
function clear(svg){while(svg.firstChild) svg.removeChild(svg.firstChild);}
function drawLine(rows,n){
  const svg=$('#line'); clear(svg);
  const xs=rows.slice(1).map(r=>parseFloat(r[n])).filter(x=>!isNaN(x)); if(!xs.length) return;
  const W=svg.clientWidth||600,H=220,min=Math.min(...xs),max=Math.max(...xs),rng=(max-min)||1;
  for(let i=0;i<=4;i++){const y=(i/4)*H;const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',0);ln.setAttribute('x2',W);ln.setAttribute('y1',y);ln.setAttribute('y2',y);
    ln.setAttribute('stroke','#134c4c');ln.setAttribute('stroke-width','1');svg.appendChild(ln);}
  const pts=xs.map((v,i)=>`${(i/Math.max(1,xs.length-1))*W},${H-((v-min)/rng)*H}`).join(' ');
  const p=document.createElementNS('http://www.w3.org/2000/svg','polyline');
  p.setAttribute('fill','none');p.setAttribute('stroke','#4afff0');p.setAttribute('stroke-width','2');p.setAttribute('points',pts);svg.appendChild(p);
}
function drawBars(rows,n){
  const svg=$('#bars'); clear(svg);
  const xs=rows.slice(1).map(r=>parseFloat(r[n])).filter(x=>!isNaN(x)); if(!xs.length) return;
  const W=svg.clientWidth||600,H=220,max=Math.max(...xs)||1,slot=W/xs.length,barW=Math.max(1,slot-3);
  for(let i=0;i<=4;i++){const y=(i/4)*H;const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',0);ln.setAttribute('x2',W);ln.setAttribute('y1',y);ln.setAttribute('y2',y);
    ln.setAttribute('stroke','#134c4c');ln.setAttribute('stroke-width','1');svg.appendChild(ln);}
  xs.forEach((v,i)=>{const h=(v/max)*H,x=i*slot+(slot-barW)/2,y=H-h;const r=document.createElementNS('http://www.w3.org/2000/svg','rect');
    r.setAttribute('x',x);r.setAttribute('y',y);r.setAttribute('width',barW);r.setAttribute('height',h);
    r.setAttribute('fill','#26d9cf');r.setAttribute('rx','4');svg.appendChild(r);});
}
</script>
</body>
</html>
